<div class="cover" style="page-break-after:always;font-family:方正公文仿宋;width:100%;height:100%;border:none;margin: 0 auto;text-align:center;">
    <div style="width:60%;margin: 0 auto;height:0;padding-bottom:10%;">
        </br></br></br></br></br></br>
        <img src="https://raw.githubusercontent.com/HeZean/HeZean/master/LaTeX%20Templates/Typora/SUSTech-LOGO.svg" alt="SUSTC Logo" style="width:40%;"/>
    </div>
    </br></br></br></br></br></br></br></br></br></br></br></br></br>
    <span style="font-family:华文黑体Bold;text-align:center;font-size:20pt;margin: 10pt auto;line-height:30pt;">《停车管理系统： FPGA实现》</span></br></br>
    <p style="text-align:center;font-size:14pt;margin: 0 auto">期末报告</p>
    </br></br></br></br></br></br>
    <table style="border:none;text-align:center;width:62%;font-family:仿宋;font-size:14px; margin: 0 auto;">
    <tbody style="font-family:方正公文仿宋;font-size:12pt;">
    <tr style="font-weight:normal;"> 
   	<td style="width:20%;text-align:right;">课　　程</td>
    		<td style="width:2%">：</td> 
    		<td style="width:40%;font-weight:normal;border-bottom: 1px solid;text-align:center;font-family:华文仿宋">数字逻辑 (CS207)</td>     </tr>
    	<tr style="font-weight:normal;"> 
    		<td style="width:20%;text-align:right;">授课教师</td>
    		<td style="width:2%">：</td> 
    		<td style="width:40%;font-weight:normal;border-bottom: 1px solid;text-align:center;font-family:华文仿宋">Georgios Theodoropoulos</td>     </tr>
    	<tr style="font-weight:normal;"> 
    		<td style="width:20%;text-align:right;">姓　　名</td>
    		<td style="width:2%">：</td> 
    		<td style="width:40%;font-weight:normal;border-bottom: 1px solid;text-align:center;font-family:华文仿宋">李子南；唐昕宇；何泽安</td>     </tr>
    	<tr style="font-weight:normal;"> 
    		<td style="width:20%;text-align:right;">学　　号</td>
    		<td style="width:2%">：</td> 
    		<td style="width:40%;font-weight:normal;border-bottom: 1px solid;text-align:center;font-family:华文仿宋">12011517；12011439；12011323</td>     </tr>
    		<td style="width:20%;text-align:right;">日　　期</td>
    		<td style="width:2%">：</td> 
    		<td style="width:40%;font-weight:normal;border-bottom: 1px solid;text-align:center;font-family:华文仿宋">2021 年 12 月 31 日</td>     </tr>
    </tbody>              
    </table>
</br></br></br></br>
</div>

[TOC]



## Development Plan

​	Among the topics provided, we have chosen the parking lot management system as our project, which requires us to design a rather complex FSM and thus the process of completing this project gave us a lot of improvement in our understanding of digital logic and our ability to code.

### Task Assignments \& Contribution of Members

​	As a whole, in this project, the three group members had a similar workload, and there were sufficient and timely communications and mutual assistance during the implementation process. Due to the heavy functionality of our selection (parking lot management system), for complex modules, the leading member of implementation is listed below, while the rest of the modules were reasonably evenly distributed. After all, we summarize the percentage of group members' contributions as 33% - 33% - 33%.





## 顶层模块

### 接口和变量描述

​	顶层模块接收一个时钟信号clk(连接Y18管脚)，一个使能信号enable(连接一个拨码开关)，一个音乐使能信号music_en(链接一个拨码开关)，5位按钮输入button，4位键盘输入row，4位键盘输出col，8位显示输出DIG和Y，一位音乐输出music_frac_ext(连接蜂鸣器)  

### 子模块

#### 分频器

```verilog
freq_div_even #(100000000,31) freq1(clk, enable, clk2);//1s
freq_div_even #(500000, 31) freq2(clk, enable, clk3);//0.005s
```

​	clk2, clk3 是一位wire类型变量，频率分别为1Hz和200Hz。

#### 按钮除抖

```verilog
ButtonVibration BV(clk, enable, button, buttonVib);
```

​	buttonVib是5位wire类型变量，代表除抖后的按钮信号。

#### 音乐播放模块

```verilog
musicplayer music(clk, music_sel,music_en, music_frac_ext);
```

​	music_sel为3位wire类型变量，代表选择音乐播放模式，music_en为音乐使能信号，music_frac_ext为音乐输出。

### 4. 键盘输入

```verilog
multi_key mult(buttonVib[2], clk, 2, row, col, DIG1, Y1, finish, key);
```

​	buttonVib[2]为输入模块的使能信号(因为要用输入模块之前必定会按下buttonVib[2])，常数2为最多连续输入位数，DIG1，Y1为键盘显示输出(不调用)，finish为一位wire变量，代表输入是否完成，key为30位wire变量，为键盘输出(最多支持输入5位，即每位6bit)

### 5. 主状态机

```verilog
FSM fsm(buttonVib, clk2, clk3, enable, key, finish, displayMode, stallLeft,start, per, id0, id1, remain0, remain1, x0, x1, x2, x3, x4, x5, x6, x7, music_sel);
```

​	displayMode, stallLeft, per, id0, id1, remain0, remain1, x0, x1, x2, x3, x4, x5, x6, x7, music_sel都为FSM的输出，都为wire类型变量。

### 6. 主显示模块

```verilog
display_top display(displayMode, clk, stallLeft, start, per, id0, id1, remain0, remain1, x7, x6, x5, x4, x3, x2, x1, x0, DIG, Y);
```

​	DIG，Y为顶层模块输出。



## 约束文件

### 端口绑定描述

```verilog
set_property PACKAGE_PIN Y18 [get_ports clk]//时钟信号

set_property PACKAGE_PIN P5 [get_ports button[0]]//按钮上键
set_property PACKAGE_PIN P2 [get_ports button[1]]//按钮下键
set_property PACKAGE_PIN P1 [get_ports button[2]]//按钮左键
set_property PACKAGE_PIN R1 [get_ports button[3]]//按钮右键
set_property PACKAGE_PIN P4 [get_ports button[4]]//按钮中键

set_property PACKAGE_PIN W4 [get_ports music_en]//音乐开关

set_property PACKAGE_PIN Y9 [get_ports enable]//总开关

set_property PACKAGE_PIN M2 [get_ports {col[3]}]//键盘列扫描
set_property PACKAGE_PIN K6 [get_ports {col[2]}]
set_property PACKAGE_PIN J6 [get_ports {col[1]}]
set_property PACKAGE_PIN L5 [get_ports {col[0]}]
set_property PACKAGE_PIN K4 [get_ports {row[3]}]//键盘行扫描
set_property PACKAGE_PIN J4 [get_ports {row[2]}]
set_property PACKAGE_PIN L3 [get_ports {row[1]}]
set_property PACKAGE_PIN K3 [get_ports {row[0]}]

set_property PACKAGE_PIN A18 [get_ports {DIG[7]}] //单个七段数码显示管的使能信号
set_property PACKAGE_PIN A20 [get_ports {DIG[6]}]
set_property PACKAGE_PIN B20 [get_ports {DIG[5]}]
set_property PACKAGE_PIN E18 [get_ports {DIG[4]}]
set_property PACKAGE_PIN F18 [get_ports {DIG[3]}]
set_property PACKAGE_PIN D19 [get_ports {DIG[2]}]
set_property PACKAGE_PIN E19 [get_ports {DIG[1]}]
set_property PACKAGE_PIN C19 [get_ports {DIG[0]}]
set_property PACKAGE_PIN E13 [get_ports {Y[7]}] //单个七段数码显示管上的引脚
set_property PACKAGE_PIN C15 [get_ports {Y[6]}]
set_property PACKAGE_PIN C14 [get_ports {Y[5]}]
set_property PACKAGE_PIN E17 [get_ports {Y[4]}]
set_property PACKAGE_PIN F16 [get_ports {Y[3]}]
set_property PACKAGE_PIN F14 [get_ports {Y[2]}]
set_property PACKAGE_PIN F13 [get_ports {Y[1]}]
set_property PACKAGE_PIN F15 [get_ports {Y[0]}]
```

